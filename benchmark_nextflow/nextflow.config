docker.enabled    = false
conda.enabled     = true
apptainer.enabled = false
report.overwrite  = true

workDir        = 'work'
projectDir     = './'
publishDir     = './'

conda_prefix = "/home/tej/anaconda3/envs"

process {
    maxForks = 2
    cpus = 20
    mem = 100.GB
    time = 3.d

    resourceLimits: [
        memory: 250.GB,
        cpus: 80,
        accelerator: 2
    ]
    
    withLabel: gpu {
        accelerator = 2
        cpus = 40
        memory = 128.GB
        maxForks = 1
    }

    withLabel: cpu {
        cpus = 20
        memory = 100.GB
        maxForks = 4
    }

    withLabel: download {
        cpus = 5
        memory = 50.GB
    }

    withLabel: "std_conda" {
        conda = "workflow/envs/benchmarking_env.yml"
    }

    withLabel: 'rockfish' {
        conda = "${conda_prefix}/${params.toolConfig.rockfish.conda}"
    }
    withLabel: "deepmod2" {
        conda = "${conda_prefix}/${params.toolConfig.deepmod2.conda}"
    }
    
    withName: 'deepbam_call' {
        conda = "${conda_prefix}/${params.toolConfig.deepbam.conda}"
    }
    withName: 'deepplant_call' {
        conda = "${conda_prefix}/${params.toolConfig.deepplant.conda}"
    }
}

profiles {
    apptainer {
        apptainer {
            enabled = true
            autoMounts = true
            
            runOptions = '--cleanenv --contain'
        }
        docker.enabled = false
    }
    cluster {
        process.queueSize = 2
        process.cpus=25
        process.executor="pbs"
        process.queue="cpu-q"
        process.memory=110.GB
        process.time=20.d
        process.clusterOptions=""
        process.resourceLimits = [
            memory: 250.GB,
            cpus: 56,
            time: 30.d,
            accelerator: 2
        ]
    }
}
